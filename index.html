<div> ‚ö†Ô∏èDISCLAMER: This is a FAKE order for entertainment purposes only.<br>We may create an ASMR video for you, but no real items will be delivered.<br>No silly orders please!<br>All
  prices are FAKE!‚ö†Ô∏è
<meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Squishtopia‚ú®</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --pink:#ffb6d9;
      --blue:#4da3ff;
      --blue-hover:#1c8bff;
      --bg1:#ffd4e5;
      --bg2:#d4e3ff;
    }
    html,body{height:100%;margin:0;padding:0;}
    body{
      font-family:'Fredoka',sans-serif;
      padding:24px;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      border:none solid var(--pink);
      box-sizing:border-box;
      min-height:100vh;
      overflow-x:hidden;
    }
    h1{text-align:center;font-size:36px;color:#ff6fa8;margin:6px 0 18px;text-shadow:2px 2px white;}
    .container{max-width:920px;margin:8px auto 60px;}
    .item{display:flex;align-items:center;gap:12px;background:#ffffffcc;padding:12px;border-radius:12px;margin-bottom:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06);}
    .item img{width:72px;height:72px;object-fit:cover;border-radius:12px;border:3px solid #fff;}
    .title{flex:1;font-weight:700;color:#333;}
    .controls{display:flex;align-items:center;gap:8px;}
    input[type="number"]{width:64px;padding:6px;border-radius:8px;border:1px solid #ddd;}
    .btn{background:var(--blue);color:white;border:3px solid var(--pink);padding:8px 12px;border-radius:12px;font-weight:700;cursor:pointer;}
    .btn.small{padding:6px 8px;font-size:13px;border-radius:8px}
    .btn:disabled{opacity:0.5;cursor:not-allowed;}
    #cart{margin-top:18px;padding:16px;border-top:4px dashed var(--pink);background:rgba(255,255,255,0.6);border-radius:10px;}
    .cart-item{display:flex;align-items:center;gap:12px;padding:8px 0;border-bottom:1px solid #f2e9f3;}
    .cart-item img{width:48px;height:48px;border-radius:8px;}
    .cart-empty{color:#666;padding:8px 0;}
    /* admin panel */
    #adminPanel{display:none;margin-top:18px;background:#fff7fb;padding:12px;border-radius:12px;box-shadow:0 4px 14px rgba(0,0,0,0.06);}
    #adminPanel input[type="text"], #adminPanel input[type="number"]{padding:6px;border-radius:8px;border:1px solid #ddd}
    .admin-row{display:flex;gap:8px;align-items:center;margin-bottom:8px;}
    /* remove button style */
    .remove-btn { background: #ff6b6b; color: #fff; border: 0; padding:6px 10px; border-radius:8px; cursor:pointer; }
    .remove-btn:hover{ opacity:0.95; transform: translateY(-1px); }
    /* modal */
    .modal { position:fixed; left:0; top:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.4); z-index:50; }
    .modal .box { background:white; padding:16px; border-radius:8px; width:320px; text-align:center; }
    .small { font-size:13px; color:#666 }
    .emoji-wrap{position:fixed;left:0;top:0;right:0;bottom:0;pointer-events:none;overflow:hidden;z-index:5;}
    .floating-emoji{position:absolute;font-size:36px;opacity:.9;transform:translateY(100vh);}
    pre { background:#fafafa;padding:8px;border-radius:6px;overflow:auto;max-height:160px;}
      
    
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Squishtopia‚ú®</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --pink:#ffb6d9;
      --blue:#4da3ff;
      --blue-hover:#1c8bff;
      --bg1:#ffd4e5;
      --bg2:#d4e3ff;
    }
    html,body{height:100%;margin:0;padding:0;}
    body{
      font-family:'Fredoka',sans-serif;
      padding:24px;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      border:none solid var(--pink);
      box-sizing:border-box;
      min-height:100vh;
      overflow-x:hidden;
    }
    h1{text-align:center;font-size:36px;color:#ff6fa8;margin:6px 0 18px;text-shadow:2px 2px white;}
    .container{max-width:920px;margin:8px auto 60px;}
    .item{display:flex;align-items:center;gap:12px;background:#ffffffcc;padding:12px;border-radius:12px;margin-bottom:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06);}
    .item img{width:72px;height:72px;object-fit:cover;border-radius:12px;border:3px solid #fff;}
    .title{flex:1;font-weight:700;color:#333;}
    .controls{display:flex;align-items:center;gap:8px;}
    input[type="number"]{width:64px;padding:6px;border-radius:8px;border:1px solid #ddd;}
    .btn{background:var(--blue);color:white;border:3px solid var(--pink);padding:8px 12px;border-radius:12px;font-weight:700;cursor:pointer;}
    .btn.small{padding:6px 8px;font-size:13px;border-radius:8px}
    .btn:disabled{opacity:0.5;cursor:not-allowed;}
    #cart{margin-top:18px;padding:16px;border-top:4px dashed var(--pink);background:rgba(255,255,255,0.6);border-radius:10px;}
    .cart-item{display:flex;align-items:center;gap:12px;padding:8px 0;border-bottom:1px solid #f2e9f3;}
    .cart-item img{width:48px;height:48px;border-radius:8px;}
    .cart-empty{color:#666;padding:8px 0;}
    /* admin panel */
    #adminPanel{display:none;margin-top:18px;background:#fff7fb;padding:12px;border-radius:12px;box-shadow:0 4px 14px rgba(0,0,0,0.06);}
    #adminPanel input[type="text"], #adminPanel input[type="number"]{padding:6px;border-radius:8px;border:1px solid #ddd}
    .admin-row{display:flex;gap:8px;align-items:center;margin-bottom:8px;}
    /* remove button style */
    .remove-btn { background: #ff6b6b; color: #fff; border: 0; padding:6px 10px; border-radius:8px; cursor:pointer; }
    .remove-btn:hover{ opacity:0.95; transform: translateY(-1px); }
    /* modal */
    .modal { position:fixed; left:0; top:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.4); z-index:50; }
    .modal .box { background:white; padding:16px; border-radius:8px; width:320px; text-align:center; }
    .small { font-size:13px; color:#666 }
    .emoji-wrap{position:fixed;left:0;top:0;right:0;bottom:0;pointer-events:none;overflow:hidden;z-index:5;}
    .floating-emoji{position:absolute;font-size:36px;opacity:.9;transform:translateY(100vh);}
    pre { background:#fafafa;padding:8px;border-radius:6px;overflow:auto;max-height:160px;}
  </style>
  <link rel="icon" type="image/x-icon" href="fafaddad.ico">
</head>
<body>
  
 
  <div class="container">
    <h1>Squishtopia‚ú®</h1>
    
    <div style="display:none;">
      <button id="openAdminBtn" class="btn">Admin Login</button>
      <button id="refreshBtn" class="btn" style="background:var(--pink);color:#333">Refresh Data</button>
    </div>
    
    <!-- WELCOME PAGE -->
<div id="welcomePage" style="display:flex;height:100vh;align-items:center;justify-content:center;flex-direction:column;text-align:center;font-family:'Fredoka', sans-serif;">
          <!-- HERO IMAGE BLOCK -->
<div id="heroBlock" style="width:100%; text-align:center;">
  <img src="https://i.postimg.cc/sgcvtHnm/Gemini-Generated-Image-tvnphltvnphltvnp.png" id="heroImg" style="width:80%; height:auto; object-fit:cover;">
</div>
  <h1>Welcome to Squishtopia! üéâ</h1>
  <p style="margin-top:10px;color:#555;font-size:16px;">
    Here you can create fake orders for fun and watch ASMR videos of squishys!
  </p>
  <button class="btn" onclick="goToShopFromWelcome()" style="margin-top:20px;font-size:16px;">Enter Shop</button>

    </div>


    
<!-- SHOP -->
<div id="shopPage" style="display:none;">

  
  
  <button class="btn" onclick="scrollToBottom()">Go to Cart</button>


  <!-- Category Buttons -->
  <div id="categoryButtons" style="margin-bottom:12px;">

  </div>

  <!-- Product Items -->
  <div id="items"></div>

  <!-- Cart -->
  <div id="cart">
    <h3>Your Cart</h3>
    <div id="cartContents" class="cart-empty">Your cart is empty.</div>
  </div>

  <!-- Checkout -->
  <button id="checkoutBtn" class="btn" style="width:100%;margin-top:12px;font-size:16px;" onclick="sendToMainDevice()" disabled>
    Checkout
  </button>

</div>




 <!-- Admin buttons (fixed) -->
<div id="adminButtons" style="display:none;">
  <button id="addProductBtn" class="btn">Add Product</button>
  <button id="logoutAdmin" class="btn" style="background:#ff8686">Logout Admin</button>
</div>


  <!-- THANK YOU PAGE -->
  <div id="thankYouPage" style="display:none;height:100vh;align-items:center;justify-content:center;flex-direction:column;text-align:center;font-family:'Fredoka', sans-serif;">
    <h1>Thanks for shopping! üéâ</h1>
    <p>Your fake squishy order has been sent to our workshop üç≠‚ú®</p>
    <button class="btn" onclick="goToShop()" style="margin-top:10px;">Shop More</button>
  </div>

  <div class="emoji-wrap" id="emojiWrap"></div>

  <!-- FIREBASE MODULE -->
  <script type="module">
    // Firebase modular SDK (CDN)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import {
      getFirestore, collection, doc, getDoc, getDocs, setDoc, updateDoc
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    // <-- YOUR firebaseConfig -->
    const firebaseConfig = {
      apiKey: "AIzaSyAY7ODTRPbqWbN7vojoq4sGojPikNmQpqs",
      authDomain: "everything-in-edible.firebaseapp.com",
      projectId: "everything-in-edible",
      storageBucket: "everything-in-edible.firebasestorage.app",
      messagingSenderId: "38803397040",
      appId: "1:38803397040:web:73825596545906e8b01e75",
      measurementId: "G-ZDWYE5X7BQ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Expose helper functions that the main script uses
    window.firebaseHelpers = {
      // load products collection (documents contain {name,img,max})
      async loadProducts() {
        const snap = await getDocs(collection(db, "products"));
        const arr = [];
        snap.forEach(d => arr.push(d.data()));
        return arr;
      },

      // save product doc and ensure stock doc exists
      async saveProduct(product) {
        await setDoc(doc(db, "products", product.name), product);
        const sRef = doc(db, "stock", product.name);
        const sSnap = await getDoc(sRef);
        if (!sSnap.exists()) {
          await setDoc(sRef, { count: Number(product.max) || 0 });
        }
        return true;
      },

      // returns { "Product Name": count, ... }
      async loadStockMap() {
        const snap = await getDocs(collection(db, "stock"));
        const map = {};
        snap.forEach(d => {
          const data = d.data();
          // if count exists and is numeric, use it ‚Äî otherwise treat missing as undefined (so caller can decide)
          if (data && (typeof data.count === 'number' || !Number.isNaN(Number(data.count)))) {
            map[d.id] = typeof data.count === 'number' ? data.count : Number(data.count);
          } else {
            // explicitly set undefined to indicate no value in DB
            map[d.id] = undefined;
          }
        });
        return map;
      },

      // set stock for a product (doc id = productName)
      async setStock(productName, newCount) {
        await setDoc(doc(db, "stock", productName), { count: Number(newCount) });
        return true;
      },

      // save order and optionally decrement stock (if doDecrement === true)
      async saveOrderAndMaybeDecrement(cart, doDecrement, buyerName) {
        try {
          // advance counter
          const settingsRef = doc(db, "settings", "counter");
          const settingsSnap = await getDoc(settingsRef);
          let next = 1;
          if (settingsSnap.exists()) {
            const last = settingsSnap.data().lastOrder || 0;
            next = last + 1;
          }
          await setDoc(settingsRef, { lastOrder: next });

          // save order doc
          const orderRef = doc(db, "orders", `order-${next}`);
          await setDoc(orderRef, {
            orderNumber: next,
            buyerName: buyerName || "Unknown",
            items: cart,
            time: (new Date()).toISOString()
          });


          return { ok: true };
        } catch (err) {
          console.error("Firestore order error:", err);
          return { ok: false, error: err.message || String(err) };
        }
      }
    };

    
    // Seed defaults if products collection empty (first-run)
    (async function seedIfEmpty(){
      const pSnap = await getDocs(collection(db, "products"));
      if (pSnap.size === 0) {
        const defaults = [
          {name:"Blue Heat Takis", img:"https://i.postimg.cc/65p1v6m6/download-(1).jpg", max:1},
          {name:"Fuego Takis", img:"https://i.postimg.cc/tRZsCFXN/fuego-takiisss.jpg", max:1},
          {name:"Cookies", img:"https://i.postimg.cc/Jz7Jh9yK/cruble-cookieee.jpg", max:2},
          {name:"Sugar Bliss Cookies", img:"https://i.postimg.cc/y8cLcJsm/cookie-bliss-jar.jpg", max:1},
          {name:"Water", img:"https://i.postimg.cc/Yq2Q3bYF/waterrr.jpg", max:1},
          {name:"Ice Pop Prime", img:"https://i.postimg.cc/KzNR3h99/ice-pop-prime.jpg", max:1},
          {name:"Ice Tea Peach", img:"https://i.postimg.cc/XvgVQc9t/ice-tea-xixo.jpg", max:1},
          {name:"Fruit Mix Boba", img:"https://i.postimg.cc/N00gC2bb/rainbow-boba.jpg", max:1},
          {name:"Matcha Boba", img:"https://i.postimg.cc/Qd8sVK2b/match-boba.jpg", max:1}
        ];
        for (const p of defaults) {
          await setDoc(doc(db, "products", p.name), p);
          const sRef = doc(db, "stock", p.name);
          const sSnap = await getDoc(sRef);
          if (!sSnap.exists()) await setDoc(sRef, { count: p.max });
        }
      }
    })();

  </script>

  <!-- MAIN SCRIPT (non-module; UI + logic) -->
  <script>
    // UI state
    let isAdmin = false;
    let products = [];
    let stockMap = {}; // { name: countOrUndefined }
    let cart = [];

    // DOM
    const itemsEl = document.getElementById("items");
    const cartContents = document.getElementById("cartContents");
    const checkoutBtn = document.getElementById("checkoutBtn");
    const openAdminBtn = document.getElementById("openAdminBtn");
    const adminPanel = document.getElementById("adminPanel");
    const stockList = document.getElementById("stockList");
    const addProductBtn = document.getElementById("addProductBtn");
    const refreshBtn = document.getElementById("refreshBtn");

    // Renderers
    function renderProducts(){
      itemsEl.innerHTML = products.map((p,i) => {
        // realStock: use number when present in stockMap (including 0).
        // If stockMap doesn't have the key (undefined) and product has a max, use that as fallback.
        let realStock;
        if (Object.prototype.hasOwnProperty.call(stockMap, p.name) && typeof stockMap[p.name] === 'number') {
          realStock = stockMap[p.name];
        } else {
          realStock = typeof p.max === 'number' ? p.max : 0;
        }

        const disabledAttr = realStock <= 0 ? 'disabled' : '';
        const maxAttr = Math.max(1, realStock); // input max should be at least 1 when enabled

        return `
          <div class="item" data-name="${p.name}">
            <img src="${p.img}" alt="${p.name}">
            <div class="title">${p.name}</div>
            <div class="controls">
              <input id="qty${i}" type="number" min="1" max="${maxAttr}" value="1" ${disabledAttr}>
              <button class="btn" onclick="addToCartFromInputs('${p.name}','${p.img}','qty${i}')" ${disabledAttr}>Add</button>
              <div style="margin-left:8px;font-size:13px;color:#555">Stock: ${realStock}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderCart(){
      if (cart.length === 0) {
        cartContents.innerHTML = '<div class="cart-empty">Your cart is empty.</div>';
        checkoutBtn.disabled = true;
        return;
      }
      checkoutBtn.disabled = false;
      cartContents.innerHTML = cart.map((it,i)=>`
        <div class="cart-item">
          <img src="${it.image}" alt="${it.name}">
          <div style="flex:1;">
            <div style="font-weight:700">${it.name}</div>
            <div style="color:#666;font-size:13px">Quantity: ${it.quantity}</div>
          </div>
          <button class="remove-btn" onclick="removeFromCart(${i})">Remove</button>
        </div>
      `).join('');
    }

    function renderStockEditor(){
      // show inputs for each product in admin panel
      stockList.innerHTML = products.map(p => {
        const cnt = (Object.prototype.hasOwnProperty.call(stockMap, p.name) && typeof stockMap[p.name] === 'number') ? stockMap[p.name] : (typeof p.max === 'number' ? p.max : 0);
        return `
          <div class="admin-row">
            <div style="flex:1;font-weight:700">${p.name}</div>
            <input id="stock-${encodeURIComponent(p.name)}" type="number" min="0" value="${cnt}" style="width:90px;">
            <button class="btn small" onclick="saveStock('${p.name}')">Save</button>
          </div>
        `;
      }).join('');
    }

    // Cart actions
    window.addToCartFromInputs = function(name, img, qtyId){
      const qtyEl = document.getElementById(qtyId);
      let qty = Number(qtyEl.value) || 1;
      qtyEl.value = 1;

      // available: if stockMap has a number for name, use it; otherwise fall back to product.max
      let available;
      if (Object.prototype.hasOwnProperty.call(stockMap, name) && typeof stockMap[name] === 'number') available = stockMap[name];
      else {
        const prod = products.find(p=>p.name===name);
        available = prod ? (typeof prod.max === 'number' ? prod.max : Infinity) : Infinity;
      }

      const existing = cart.find(c => c.name === name);
      const alreadyInCart = existing ? existing.quantity : 0;
      const canAdd = Math.max(0, available - alreadyInCart);
      if (canAdd <= 0) {
        alert("No more stock available for " + name);
        return;
      }
      const toAdd = Math.min(qty, canAdd);

      if (existing) existing.quantity += toAdd;
      else cart.push({ name, image: img, quantity: toAdd });

      renderCart();
    };

    window.removeFromCart = function(i){
      cart.splice(i,1);
      renderCart();
    };

   // Checkout with buyer name
async function sendToMainDevice() {
  if (cart.length === 0) {
    alert("Your cart is empty! Add something first.");
    return;
  }

  // Ask buyer for their name
  const buyerName = prompt("‚ú®Enter your name for your ASMR video!‚ú®");
  if (!buyerName || !buyerName.trim()) {
    alert("Please enter a valid name.");
    return;
  }

  const order = {
    buyerName: buyerName.trim(), // store name
    items: cart.map(c => ({ name: c.name, quantity: c.quantity })),
    time: new Date().toISOString()
  };

  if (window.firebaseHelpers && typeof window.firebaseHelpers.saveOrderAndMaybeDecrement === 'function') {
    const res = await window.firebaseHelpers.saveOrderAndMaybeDecrement(order.items, isAdmin, buyerName.trim());
    if (!res.ok) {
      alert("‚ùå Could not send to main device (Firebase error). See console.");
      console.error(res);
      return;
    }
  } else {
    console.warn("Firebase helper not available; order not saved to DB.");
  }

  if (isAdmin) {
    for (const it of cart) {
      if (Object.prototype.hasOwnProperty.call(stockMap, it.name) && typeof stockMap[it.name] === 'number') {
        stockMap[it.name] = Math.max(0, stockMap[it.name] - it.quantity);
      }
    }
    renderProducts();
    renderStockEditor();
  }

  cart = [];
  renderCart();
  goToThankYou();
}
window.sendToMainDevice = sendToMainDevice;


    // Admin helpers
    window.saveStock = async function(name){
      const el = document.getElementById('stock-' + encodeURIComponent(name));
      if (!el) return;
      const newCount = Number(el.value);
      if (isNaN(newCount) || newCount < 0) { alert("Enter valid number"); return; }
      if (window.firebaseHelpers && typeof window.firebaseHelpers.setStock === 'function') {
        const ok = await window.firebaseHelpers.setStock(name, newCount);
        if (!ok) { alert("Could not save stock ‚Äî check console"); return; }
      }
      // update local map and UI immediately
      stockMap[name] = newCount;
      renderProducts();
      renderStockEditor();
      alert("Saved " + name + " = " + newCount);
    };

    addProductBtn.addEventListener('click', async () => {
      const name = document.getElementById('newName').value.trim();
      const img = document.getElementById('newImg').value.trim();
      const max = Number(document.getElementById('newMax').value) || 1;
      if (!name || !img) { alert("Enter name and image URL"); return; }

      const product = { name, img, max };
      if (window.firebaseHelpers && typeof window.firebaseHelpers.saveProduct === 'function') {
        await window.firebaseHelpers.saveProduct(product);
      }
      products.push(product);
      // set initial stock locally to max (Firestore seed will ensure doc exists)
      stockMap[product.name] = max;
      renderProducts();
      renderStockEditor();
      document.getElementById('newName').value = '';
      document.getElementById('newImg').value = '';
      document.getElementById('newMax').value = '1';
      alert("Product added: " + name);
    });

    // Admin login / logout
    openAdminBtn.addEventListener('click', () => {
      const pass = prompt("Enter admin password:");
      if (pass === "5001") {
        isAdmin = true;
        adminPanel.style.display = 'block';
        alert("Admin logged in.");
        refreshData(); // reload to ensure latest stock is shown
      } else alert("Wrong password.");
    });

    document.getElementById("logoutAdmin").addEventListener('click', () => {
      isAdmin = false;
      adminPanel.style.display = 'none';
      alert("Admin logged out.");
      refreshData();
    });

    refreshBtn.addEventListener('click', refreshData);

    // navigation
    function goToThankYou(){
      document.getElementById("shopPage").style.display = "none";
      document.getElementById("thankYouPage").style.display = "flex";
    }
    function goToShop(){
      document.getElementById("thankYouPage").style.display = "none";
      document.getElementById("shopPage").style.display = "block";
    }
    window.goToShop = goToShop;

    // welcome page navigation
function goToShopFromWelcome() {
  document.getElementById("welcomePage").style.display = "none";
  document.getElementById("shopPage").style.display = "block";
}
window.goToShopFromWelcome = goToShopFromWelcome;
    
    // load products + stock from Firestore (or fallbacks)
    
    
    
const defaultProducts = [
  // Drinks
  
  {name:"Water $3", img:"https://i.postimg.cc/Yq2Q3bYF/waterrr.jpg", max:1, category:"Drinks"},
  {name:"Ice Pop Prime $3", img:"https://i.postimg.cc/KzNR3h99/ice-pop-prime.jpg", max:1, category:"Drinks"},
  {name:"Ice Tea Peach $3", img:"https://i.postimg.cc/XvgVQc9t/ice-tea-xixo.jpg", max:1, category:"Drinks"},
  {name:"Fruit Mix Boba $3", img:"https://i.postimg.cc/N00gC2bb/rainbow-boba.jpg", max:1, category:"Drinks"},
  {name:"Matcha Boba $3", img:"https://i.postimg.cc/Qd8sVK2b/match-boba.jpg", max:1, category:"Drinks"},

  // Cookies
     {name:"Mini Blue Raspberry Pop Tart (NEW) $2", img:"https://i.postimg.cc/jSqdKbgn/vodanoj-znak.jpg", max:1, category:"Cookies"},
  {name:"Chips Ahoy! $3", img:"https://i.postimg.cc/fLj5NyZQ/download-(10).jpg", max:1, category:"Cookies"},
   {name:"Mega Strawberry Pop Tart $6", img:"https://i.postimg.cc/k52yBwC9/Pop-Tarts-Frosted-Strawberry-Breakfast-Toaster-Pastries-416g-8-Count-Walmart-com.jpg", max:1, category:"Cookies"},
  {name:"Cookies $2", img:"https://i.postimg.cc/Jz7Jh9yK/cruble-cookieee.jpg", max:2, category:"Cookies"},
  {name:"Sugar Bliss Cookies $5", img:"https://i.postimg.cc/y8cLcJsm/cookie-bliss-jar.jpg", max:1, category:"Cookies"},
  {name:"Crumble Cookie Pack $3", img:"https://i.postimg.cc/Kzx3cszp/Crumbl-cookies-day.jpg", max:1, category:"Cookies"},
  {name:"Oreo Pocky $3", img:"https://i.postimg.cc/mrdTvdvs/pocky-oreo.jpg", max:1, category:"Cookies"},
  {name:"Strawberry Pocky $3", img:"https://i.postimg.cc/15zrP4VD/pocky-straw-beery.jpg", max:1, category:"Cookies"},
  {name:"Jumbo Cookie $8", img:"https://i.postimg.cc/rmDR85nK/THE-BEST-COOKIE-CAKE-(recipe-link).jpg", max:1, category:"Cookies"},

  // Chips
    {name:"Salted Egg Yolk Chips $4", 
img:"https://i.postimg.cc/GtX3zKk3/Meet-your-new-favorite-snack-Gudetama-Salted-Egg-Yolk-Potato-Chips-bring-rich-savory-flavor-wit.jpg", max:1, category:"Chips"},
  {name:"Goldfish $2", 
img:"https://i.postimg.cc/XXMWVx59/Goldfish-Cheddar-Crackers-6-6oz-Irvine.jpg", max:1, category:"Chips"},
  {name:"Blue Heat Takis $4", img:"https://i.postimg.cc/65p1v6m6/download-(1).jpg", max:1, category:"Chips"},
  {name:"Fuego Takis $3", img:"https://i.postimg.cc/tRZsCFXN/fuego-takiisss.jpg", max:1, category:"Chips"},
  {name:"Hot Corn Doritos $3", img:"https://i.postimg.cc/63KbgL9n/download-(2).jpg", max:1, category:"Chips"},
  {name:"BBQ Doritos $3", img:"https://i.postimg.cc/yN1SGkwp/REVIEW-Doritos-Sweet-Tangy-BBQ.jpg", max:1, category:"Chips"},
  {name:"Classic Lays Chips $3", img:"https://i.postimg.cc/8cNc0CXJ/Lay-s-Classic-Potato-Chips-8-oz-Plastic-Bag-Walmart-com.jpg", max:1, category:"Chips"},
  {name:"Salt and Vinegar Pringles $2", img:"https://i.postimg.cc/L8LdnV8S/download-(3).jpg", max:1, category:"Chips"},
  {name:"Classic Mini Ruffles $2", img:"https://i.postimg.cc/9fkNbRMs/ruffeles-chips.jpg", max:1, category:"Chips"},
  {name:"Buttered Popcorn $2", img:"https://i.postimg.cc/3w0ZKL8D/Wise-Artificially-Flavored-Butter-Popcorn-6oz.jpg", max:1, category:"Chips"},
  {name:"Chicken Top Ramen $2", img:"https://i.postimg.cc/j270HWmv/Nissin-Top-Ramen-Chicken-Flavor-Ramen-Noodle-soup-3oz-Vista.jpg", max:1, category:"Chips"},

  // Gummies
{name:"Trolli $3", img:"https://i.postimg.cc/gjzskpkZ/download-(9).jpg", max:1, category:"Gummies"},
  {name:"Sour-Patch Kids box $4", img:"https://i.postimg.cc/bNy7BLZq/Sour-Patch-Kids-Theater-Box.jpg", max:1, category:"Gummies"},
  {name:"Hubba Bubba Roll $2", img:"https://i.postimg.cc/j5Qvb2Tk/hubba.jpg", max:1, category:"Gummies"},
    {name:"Warheads Extreme Sour $3", img:"https://i.postimg.cc/9XtY46GV/download-(8).jpg", max:1, category:"Gummies"},
    {name:"Skittles 2$", img:"https://i.postimg.cc/ry7L4Mhn/skitts.jpg", max:1, category:"Gummies"},
  {name:"Haribo Gummybears $2", img:"https://i.postimg.cc/bN2Scjv9/haribooo.jpg", max:1, category:"Gummies"},
  {name:"Airheads $1", img:"https://i.postimg.cc/JzsLd14s/airhead.jpg", max:2, category:"Gummies"},
  {name:"Hubba Bubba gum $1", img:"https://i.postimg.cc/15W7ZZ7H/Hubba-Bubba-5-Piece-Chunky-Original-Bubblegum-20-x-35g.jpg", max:1, category:"Gummies"},
  {name:"Starburst $2", img:"https://i.postimg.cc/Jn44NFsg/Starburst-Original-138g.jpg", max:1, category:"Gummies"},

  // Fluffy Snacks
  {name:"Jet Puffed Marshmallows $2", img:"https://i.postimg.cc/mDQfFgry/How-To-Make-Marshmallow-Snowflakes.jpg", max:1, category:"Fluffy Snacks"},
  {name:"Marshmallow $1", img:"https://i.postimg.cc/8Cg0BDFV/download-(4).jpg", max:1, category:"Fluffy Snacks"},
  {name:"Fluffy Stuff Cotton Candy $2", img:"https://i.postimg.cc/zvQh0ppg/Charms-Fluffy-Stuff-Cotton-Candy.jpg", max:1, category:"Fluffy Snacks"},
  {name:"Strawberry Mochi $2", img:"https://i.postimg.cc/RZ4PfZ3y/Untitled-design.png", max:1, category:"Fluffy Snacks"},

  // Chocolates
  {name:"Reese's Cups $2", img:"https://i.postimg.cc/YqR3RxQF/recces.webp", max:1, category:"Chocolates"},
  {name:"Nutella $3", img:"https://i.postimg.cc/qBb9mdTR/Best-Air-Fryers-Recipes-Easy-Air-Fryer-Ideas.jpg", max:1, category:"Chocolates"},
  {name:"Dubai Chocolate $2", img:"https://i.postimg.cc/13x7xk1x/Ulker-Cikolata-Kadayifli-Dubai-Lezzeti-93-G-Migros.jpg", max:1, category:"Chocolates"},
  {name:"Aero Chocolate Bar $2", img:"https://i.postimg.cc/7LJ3y0Gq/download-(6).jpg", max:1, category:"Chocolates"},
  {name:"Milka Chocolate Bar $3", img:"https://i.postimg.cc/hjg1bhvg/download-(7).jpg", max:1, category:"Chocolates"},
  {name:"Hershy's Chocolate Bar $2", img:"https://i.postimg.cc/HnNMKLYL/HERSHEY-S-bar-milk-chocolate-40g.jpg", max:1, category:"Chocolates"},
  {name:"Willy Wonka Chocolate Bar $2", img:"https://i.postimg.cc/bJJshjFx/Wonka-Chocolate-Bar-Sticker.jpg", max:2, category:"Chocolates"},
  {name:"Toblerone $2", img:"https://i.postimg.cc/G2GhrhxB/Toblerone-bar.jpg", max:1, category:"Chocolates"},

//Ice Creams
    {name:"Magnum Golden Chocolate Ice Cream $2", img:"https://i.postimg.cc/v8f0w1NY/Magnum-Ice-Cream-Stick-Double-Gold-Caramel-Billionaire-85-ML.jpg", max:1, category:"Ice Creams"},
  {name:"Outshine Strawberry Pack (NEW) $5", img:"https://i.postimg.cc/Zn69CzdB/download-(11).jpg", max:1, category:"Ice Creams"},
];

    
    
// === CATEGORY FILTER SCRIPT ===
let currentCategory = 'All';

// function to filter products by category and re-render
function filterCategory(cat) {
  currentCategory = cat;
  renderProducts();
}

// create category buttons dynamically
const categories = ["All","Drinks", "Cookies", "Chips", "Gummies", "Fluffy Snacks", "Chocolates", "Ice Creams"];

// make sure you have <div id="categoryButtons"></div> in your HTML above #items
const btnContainer = document.getElementById('categoryButtons');
categories.forEach(cat => {
  const btn = document.createElement('button');
  btn.textContent = cat;
  btn.className = 'btn';
  btn.style.marginRight = '8px';
  btn.onclick = () => filterCategory(cat);
  btnContainer.appendChild(btn);
});

// update renderProducts to respect currentCategory
const originalRenderProducts = renderProducts; // keep original

renderProducts = function() {
  const filtered = products.filter(p => currentCategory === 'All' || p.category === currentCategory);
  itemsEl.innerHTML = filtered.map((p,i) => {
    let realStock;
    if (Object.prototype.hasOwnProperty.call(stockMap, p.name) && typeof stockMap[p.name] === 'number') {
      realStock = stockMap[p.name];
    } else {
      realStock = typeof p.max === 'number' ? p.max : 0;
    }
    const disabledAttr = realStock <= 0 ? 'disabled' : '';
    const maxAttr = Math.max(1, realStock);

    return `
      <div class="item" data-name="${p.name}">
        <img src="${p.img}" alt="${p.name}">
        <div class="title">${p.name}</div>
        <div class="controls">
          <input id="qty${i}" type="number" min="1" max="${maxAttr}" value="1" ${disabledAttr}>
          <button class="btn" onclick="addToCartFromInputs('${p.name}','${p.img}','qty${i}')" ${disabledAttr}>Add</button>
          <div style="margin-left:8px;font-size:13px;color:#555">Stock: ${realStock}</div>
        </div>
      </div>
    `;
  }).join('');
};

    function scrollToBottom() {
  window.scrollTo({ 
    top: document.body.scrollHeight, 
    behavior: "smooth" 
  });
}
window.scrollToBottom = scrollToBottom;


async function refreshData() {
  try {
    const remoteProducts = window.firebaseHelpers?.loadProducts ? await window.firebaseHelpers.loadProducts() : null;
    products = (remoteProducts && remoteProducts.length) ? remoteProducts : defaultProducts;

    const remoteStock = window.firebaseHelpers?.loadStockMap ? await window.firebaseHelpers.loadStockMap() : {};
    stockMap = {};
    for (const p of products) stockMap[p.name] = typeof remoteStock[p.name] === 'number' ? remoteStock[p.name] : p.max;

  } catch(e) {
    console.warn("Could not load remote data:", e);
    products = defaultProducts;
    stockMap = {};
    for (const p of products) stockMap[p.name] = p.max;
  }

  renderProducts();
  renderCart();
  renderStockEditor();
}


    // initial load
    refreshData();

    // floating emojis (nice visual)
    (function(){
      const emojis=["üç™","üíñ","‚ú®","üéÄ","üç∞","üå∏","üíó","ü©∑"];
      const wrap=document.getElementById('emojiWrap');
      function spawn(){
        const el=document.createElement('div');
        el.className='floating-emoji';
        el.textContent=emojis[Math.floor(Math.random()*emojis.length)];
        el.style.fontSize=(20+Math.random()*36)+'px';
        el.style.left=(Math.random()*90)+'vw';
        wrap.appendChild(el);
        requestAnimationFrame(()=>{ el.style.transition='5s linear'; el.style.transform='translateY(-120vh)'; el.style.opacity='0'; });
        setTimeout(()=>el.remove(),5200);
      }
      setInterval(spawn,900);
      for(let i=0;i<3;i++) setTimeout(spawn,i*300);
    })();

    // expose refresh for debugging
    window.refreshData = refreshData;

  </script>
 </body>
</html>





